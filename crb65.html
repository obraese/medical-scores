<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>CRB-65 Score – Pneumonie</title>

  <!-- Global Styles / Navbar -->
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">
  <div class="card">
    <h1>CRB-65 Score (Pneumonie)</h1>
    <div class="footer-note" style="margin-top:6px;">
      Arbeits-/Lernhilfe ohne Speicherung. Klinische Entscheidung immer im Kontext (Gesamtbild, Komorbiditäten, Oxygenierung, Verlauf).
      (Kopiert wird nur Score + Kategorie.)
    </div>

    <div style="height:14px;"></div>

    <div class="card" style="box-shadow:none; border-radius:14px; padding:14px;">
      <div style="font-weight:700; margin-bottom:8px;">Kriterien</div>

      <!-- Confusion -->
      <label style="display:flex; gap:12px; align-items:flex-start; cursor:pointer; padding:10px 12px; border:1px solid var(--border); border-radius:14px; background:var(--card); margin-bottom:10px;">
        <input type="checkbox" id="c_conf" style="margin-top:3px;">
        <div style="flex:1;">
          <div style="font-weight:600; margin-bottom:4px;">C – Confusion (Verwirrtheit)</div>
          <div style="color:var(--muted); font-size:13px;">
            Neue Desorientierung / akute Verwirrtheit (klinisch auffällig).
          </div>
        </div>
        <div style="color:var(--muted); font-size:13px; white-space:nowrap;">+1</div>
      </label>

      <!-- Respiratory rate -->
      <label style="display:flex; gap:12px; align-items:flex-start; cursor:pointer; padding:10px 12px; border:1px solid var(--border); border-radius:14px; background:var(--card); margin-bottom:10px;">
        <input type="checkbox" id="c_rr" style="margin-top:3px;">
        <div style="flex:1;">
          <div style="font-weight:600; margin-bottom:4px;">R – Atemfrequenz ≥ 30/min</div>
          <div style="color:var(--muted); font-size:13px;">
            Tachypnoe ≥30/min.
          </div>
        </div>
        <div style="color:var(--muted); font-size:13px; white-space:nowrap;">+1</div>
      </label>

      <!-- Blood pressure -->
      <label style="display:flex; gap:12px; align-items:flex-start; cursor:pointer; padding:10px 12px; border:1px solid var(--border); border-radius:14px; background:var(--card); margin-bottom:10px;">
        <input type="checkbox" id="c_bp" style="margin-top:3px;">
        <div style="flex:1;">
          <div style="font-weight:600; margin-bottom:4px;">B – Blutdruck niedrig</div>
          <div style="color:var(--muted); font-size:13px;">
            Systolisch &lt; 90 mmHg <b>oder</b> diastolisch ≤ 60 mmHg.
          </div>
        </div>
        <div style="color:var(--muted); font-size:13px; white-space:nowrap;">+1</div>
      </label>

      <!-- Age -->
      <label style="display:flex; gap:12px; align-items:flex-start; cursor:pointer; padding:10px 12px; border:1px solid var(--border); border-radius:14px; background:var(--card);">
        <input type="checkbox" id="c_age" style="margin-top:3px;">
        <div style="flex:1;">
          <div style="font-weight:600; margin-bottom:4px;">65 – Alter ≥ 65 Jahre</div>
          <div style="color:var(--muted); font-size:13px;">
            Alter 65 Jahre oder älter.
          </div>
        </div>
        <div style="color:var(--muted); font-size:13px; white-space:nowrap;">+1</div>
      </label>
    </div>

    <!-- Score line -->
    <div style="display:flex; gap:12px; align-items:center; flex-wrap:wrap; margin-top:16px; padding-top:12px; border-top:1px solid var(--border);">
      <div style="font-weight:600;">CRB-65:</div>
      <div id="score" style="font-size:34px; font-weight:800;">0</div>

      <button id="copyBtn" class="navbtn" style="cursor:pointer;">kopieren</button>
      <span id="copied" style="display:none; color:green; font-size:13px;">✓ kopiert</span>

      <span style="flex:1;"></span>

      <button id="resetBtn" class="navbtn" style="cursor:pointer;">Zurücksetzen</button>
    </div>

    <!-- Band -->
    <div id="band" style="display:grid; grid-template-columns:repeat(4, 1fr); gap:10px; margin-top:12px;">
      <div id="b0" style="border:1px solid var(--border); border-radius:14px; padding:10px 12px; background:#fafafa; font-size:13px; text-align:center;">
        <strong style="display:block; margin-bottom:4px;">0</strong>
        niedrig
      </div>
      <div id="b1" style="border:1px solid var(--border); border-radius:14px; padding:10px 12px; background:#fafafa; font-size:13px; text-align:center;">
        <strong style="display:block; margin-bottom:4px;">1–2</strong>
        moderat
      </div>
      <div id="b2" style="border:1px solid var(--border); border-radius:14px; padding:10px 12px; background:#fafafa; font-size:13px; text-align:center;">
        <strong style="display:block; margin-bottom:4px;">3–4</strong>
        hoch
      </div>
      <div id="b3" style="border:1px solid var(--border); border-radius:14px; padding:10px 12px; background:#fafafa; font-size:13px; text-align:center;">
        <strong style="display:block; margin-bottom:4px;">Hinweis</strong>
        Kontext zählt
      </div>
    </div>

    <!-- Interpretation -->
    <div id="interp" class="footer-note" style="margin-top:12px; border:1px solid var(--border); border-radius:14px; padding:12px 14px; background:rgba(244,246,248,.7);">
      <b>Einordnung:</b> —
    </div>

    <!-- Footer note -->
    <div class="footer-note" style="margin-top:12px;">
      Faustregel (CRB-65): 0 oft ambulant möglich; 1–2 häufig stationär erwägen; ≥3 meist stationär/Überwachung. Immer zusätzlich beurteilen:
      Oxygenierung, Komorbiditäten, Frailty, Flüssigkeitsstatus, Sepsiszeichen, radiologischer Befund, soziale Faktoren.
    </div>
  </div>
</div>

<script>
  function clearActive() {
    ["b0","b1","b2"].forEach(id => {
      const el = document.getElementById(id);
      el.style.background = "#fafafa";
      el.style.border = "1px solid var(--border)";
      el.style.fontWeight = "normal";
      el.style.fontSize = "13px";
    });
  }

  function setActive(id) {
    const el = document.getElementById(id);
    el.style.background = "#eef6ff";
    el.style.border = "2px solid #7aa7e6";
    el.style.fontWeight = "bold";
    el.style.fontSize = "15px";
  }

  function calc() {
    document.getElementById("copied").style.display = "none";

    let s = 0;
    if (document.getElementById("c_conf").checked) s += 1;
    if (document.getElementById("c_rr").checked) s += 1;
    if (document.getElementById("c_bp").checked) s += 1;
    if (document.getElementById("c_age").checked) s += 1;

    document.getElementById("score").textContent = String(s);

    clearActive();
    let cls = "";
    let rec = "";

    if (s === 0) {
      setActive("b0");
      cls = "niedrig";
      rec = "0 Punkte: niedriges Risiko. Ambulant oft möglich, sofern klinisch stabil und sicheres Follow-up.";
    } else if (s <= 2) {
      setActive("b1");
      cls = "moderat";
      rec = "1–2 Punkte: moderates Risiko. Stationäre Abklärung/Behandlung häufig sinnvoll (Komorbiditäten, Oxygenierung, Verlauf berücksichtigen).";
    } else {
      setActive("b2");
      cls = "hoch";
      rec = "3–4 Punkte: hohes Risiko. Stationäre Aufnahme i. d. R. indiziert, häufig Überwachung/engmaschiges Monitoring.";
    }

    document.getElementById("interp").innerHTML = `<b>Einordnung:</b> ${cls} (${s} Punkt${s===1?"":"e"}). ${rec}`;
    window.__crb65_last = { score: s, cls };
    return s;
  }

  // Events
  ["c_conf","c_rr","c_bp","c_age"].forEach(id => {
    document.getElementById(id).addEventListener("change", calc);
  });

  document.getElementById("resetBtn").addEventListener("click", () => {
    ["c_conf","c_rr","c_bp","c_age"].forEach(id => document.getElementById(id).checked = false);
    calc();
  });

  document.getElementById("copyBtn").addEventListener("click", () => {
    const r = window.__crb65_last || { score: Number(document.getElementById("score").textContent || "0"), cls: "" };
    const text = `CRB-65: ${r.score} Punkt${r.score===1?"":"e"} (${r.cls || "—"})`;
    navigator.clipboard.writeText(text).then(() => {
      const msg = document.getElementById("copied");
      msg.style.display = "inline";
      setTimeout(() => msg.style.display = "none", 1500);
    });
  });

  // Initial
  calc();
</script>

<script src="nav.js"></script>
</body>
</html>
