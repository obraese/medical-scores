<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Modifizierte Duke-Kriterien (ESC 2023) – Infektiöse Endokarditis</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 30px; line-height: 1.35; }
    h1 { font-size: 22px; margin: 0 0 10px; }
    h2 { font-size: 18px; margin: 22px 0 10px; }
    .muted { color: #666; font-size: 13px; margin-bottom: 14px; }
    .box { border: 1px solid #ccc; padding: 16px; max-width: 920px; border-radius: 10px; }

    .switch {
      display: flex; gap: 10px; flex-wrap: wrap;
      padding: 10px 12px; border: 1px solid #eee; border-radius: 10px; margin-bottom: 14px;
      align-items: center;
      background: #fcfcfc;
    }

    .item {
      border: 1px solid #eee;
      padding: 12px 14px;
      border-radius: 10px;
      margin: 12px 0;
      background: #fff;
    }

    .item label {
      display: flex;
      gap: 10px;
      align-items: flex-start;
      cursor: pointer;
    }

    .content { flex: 1; }
    .title { font-weight: bold; margin-bottom: 4px; }

    .explain {
      font-size: 13px;
      color: #444;
      margin-left: 22px;
    }

    .pts {
      color: #444;
      font-size: 13px;
      white-space: nowrap;
      margin-left: 10px;
    }

    .scoreline {
      margin-top: 16px;
      padding-top: 12px;
      border-top: 1px solid #eee;
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
    }

    .score { font-size: 30px; font-weight: bold; }

    button {
      padding: 8px 12px;
      border-radius: 10px;
      border: 1px solid #ddd;
      background: #fafafa;
      cursor: pointer;
    }
    button:hover { background: #f2f2f2; }

    .copied { font-size: 13px; color: green; }

    .interpret {
      margin-top: 8px;
      font-size: 13px;
      color: #333;
      padding: 10px 12px;
      border: 1px solid #eee;
      border-radius: 10px;
      background: #fcfcfc;
    }
    .interpret strong { margin-right: 6px; }

    /* ===== Kategorieband ===== */
    .band {
      display: grid;
      gap: 10px;
      margin-top: 12px;
    }
    .band-3 { grid-template-columns: repeat(3, 1fr); }

    .bandbox {
      border: 1px solid #eee;
      border-radius: 10px;
      padding: 10px 12px;
      background: #fafafa;
      font-size: 13px;
      text-align: center;
    }
    .bandbox strong { display:block; margin-bottom: 4px; }

    .band-active {
      background: #eef6ff;
      border: 2px solid #7aa7e6;
      font-size: 15px;
      font-weight: bold;
    }

    .pill {
      display:inline-block;
      font-size:12px;
      padding:2px 8px;
      border:1px solid #ddd;
      border-radius:999px;
      background:#fafafa;
      margin-left:8px;
      color:#444;
    }

    ul.compact { margin: 6px 0 0 18px; padding: 0; }
    ul.compact li { margin: 2px 0; }

    .grid2 { display:grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    @media (max-width: 900px) { .grid2 { grid-template-columns: 1fr; } }

    /* ===== Details (aufklappbar) ===== */
    details.info {
      margin-top: 8px;
      border: 1px solid #eee;
      border-radius: 10px;
      padding: 8px 10px;
      background: #fcfcfc;
    }
    details.info summary {
      cursor: pointer;
      font-weight: bold;
      color: #333;
      outline: none;
    }
    details.info .small {
      margin-top: 8px;
      color: #333;
      font-size: 13px;
    }
    details.info .small strong { display:block; margin: 8px 0 4px; }
  </style>
</head>
<body>

<h1>Infektiöse Endokarditis: Modifizierte Duke-Kriterien (ESC 2023)</h1>
<div class="muted">
  Arbeits-/Lernhilfe. Keine Patientendaten speichern. Klinische Entscheidung immer im Kontext (Gesamtbild, Bildgebung, Mikrobiologie, Verlauf).
</div>

<div class="box">

  <div class="switch">
    <strong>ESC 2023:</strong>
    <span class="pill">Hauptkriterien / Nebenkriterien</span>
    <span style="flex:1;"></span>
    <button id="reset">Alles zurücksetzen</button>
  </div>

  <div class="grid2">
    <div>
      <h2>Hauptkriterien</h2>

      <div class="item">
        <label>
          <input type="checkbox" id="maj_path">
          <div class="content">
            <div class="title">Pathologische Kriterien erfüllt</div>
            <div class="explain">
              Z. B. Mikroorganismen oder histopathologischer Nachweis in operativem/postmortalem Material.
              <br>Wenn erfüllt: Klassifikation als <b>Endokarditis definitiv</b> (unabhängig von klinischen Haupt-/Nebenkriterien).
            </div>
          </div>
          <span class="pts">definitiv</span>
        </label>
      </div>

      <div class="item">
        <label>
          <input type="checkbox" id="maj_bc_typical">
          <div class="content">
            <div class="title">Blutkulturen positiv: typische Erreger aus 2 separaten Blutkulturen</div>
            <div class="explain">
              Typische Mikroorganismen konsistent mit IE (ESC 2023):<br>
              Oralstreptokokken, <i>Streptococcus gallolyticus</i>, HACEK, <i>Staphylococcus aureus</i>, <i>Enterococcus faecalis</i>.
            </div>
          </div>
          <span class="pts">Hauptkriterium</span>
        </label>
      </div>

      <div class="item">
        <label>
          <input type="checkbox" id="maj_bc_cont">
          <div class="content">
            <div class="title">Blutkulturen positiv: kontinuierlich positive Blutkulturen (Erreger konsistent mit IE)</div>
            <div class="explain">
              Definition (ESC 2023):<br>
              • ≥2 positive Blutkulturen aus Proben &gt;12 h auseinander, <b>oder</b><br>
              • alle von 3 oder Mehrheit von ≥4 separaten Blutkulturen (erste und letzte Probe ≥1 h auseinander).
            </div>
          </div>
          <span class="pts">Hauptkriterium</span>
        </label>
      </div>

      <div class="item">
        <label>
          <input type="checkbox" id="maj_cburnetii">
          <div class="content">
            <div class="title">Einzelne positive Blutkultur für <i>Coxiella burnetii</i> oder Phase-I-IgG &gt; 1:800</div>
            <div class="explain">
              Entspricht einem Hauptkriterium in den ESC 2023 Kriterien.
            </div>
          </div>
          <span class="pts">Hauptkriterium</span>
        </label>
      </div>

      <div class="item">
        <label>
          <input type="checkbox" id="maj_imaging">
          <div class="content">
            <div class="title">Bildgebung positiv für Endokarditis</div>
            <div class="explain">
              Valvuläre, perivalvuläre/periprothetische oder Fremdmaterial-Läsionen (anatomisch/metabolisch), charakteristisch für Endokarditis, nachweisbar durch:
              <ul class="compact">
                <li>Echokardiographie (TTE/TEE)</li>
                <li>Kardio-CT</li>
                <li>[18F]-FDG-PET/CT</li>
                <li>WBC-SPECT/CT</li>
              </ul>
            </div>
          </div>
          <span class="pts">Hauptkriterium</span>
        </label>
      </div>

    </div>

    <div>
      <h2>Nebenkriterien</h2>

      <div class="item">
        <label>
          <input type="checkbox" id="min_pred">
          <div class="content">
            <div class="title">Prädisposition</div>
            <div class="explain">
              Prädisponierende Herzerkrankung (hohes oder intermediäres Endokarditis-Risiko) <b>oder</b> i. v. Drogenkonsum.

              <!-- ===== Aufklappbare Info (neu) ===== -->
              <details class="info">
                <summary>Was bedeutet „hohes“ bzw. „intermediäres“ Endokarditis-Risiko?</summary>
                <div class="small">
                  <strong>Hohes Risiko (Beispiele nach ESC 2023):</strong>
                  <ul class="compact">
                    <li>Endokarditis in der Vorgeschichte</li>
                    <li>Prothetische Klappen (chirurgisch) oder transkathetergestützte Klappen (TAVI/TBPV) sowie Material bei Klappenrekonstruktion</li>
                    <li>Angeborene Herzfehler mit hohem Risiko: unkorrekt zyanotische CHD; CHD nach Reparatur mit prothetischem Material (insbesondere frühe Phase nach Eingriff / bei Residuen)</li>
                    <li>Ventrikuläre Unterstützungssysteme (VAD) als Destination-Therapie</li>
                  </ul>

                  <strong>Intermediäres Risiko (Beispiele nach ESC 2023):</strong>
                  <ul class="compact">
                    <li>Rheumatische Herzerkrankung</li>
                    <li>Degenerative (nicht-rheumatische) Klappenerkrankung</li>
                    <li>Angeborene Klappenanomalien (inkl. bikuspide Aortenklappe)</li>
                    <li>Kardiale implantierbare elektronische Geräte (CIED: PM/ICD/CRT)</li>
                    <li>Hypertrophe Kardiomyopathie</li>
                  </ul>

                  <div style="margin-top:8px; color:#555;">
                    Hinweis: Die Einordnung ist als klinische Orientierung gedacht; im Zweifel Einzelfall (z. B. Residualdefekte, Zeitpunkt nach Intervention, Art des Fremdmaterials) berücksichtigen.
                  </div>
                </div>
              </details>
            </div>
          </div>
          <span class="pts">Nebenkriterium</span>
        </label>
      </div>

      <div class="item">
        <label>
          <input type="checkbox" id="min_fever">
          <div class="content">
            <div class="title">Fieber &gt; 38°C</div>
            <div class="explain">Temperatur &gt; 38°C (Mess-/Dokumentationskontext beachten).</div>
          </div>
          <span class="pts">Nebenkriterium</span>
        </label>
      </div>

      <div class="item">
        <label>
          <input type="checkbox" id="min_vascular">
          <div class="content">
            <div class="title">Embolische/vaskuläre Dissemination <span style="font-weight:normal;">(inkl. asymptomatisch, nur bildgebend detektiert)</span></div>
            <div class="explain">
              Beispiele (ESC 2023):
              <ul class="compact">
                <li>Systemische oder pulmonale Embolien/Infarkte, Abszesse</li>
                <li>Hämatogene osteoartikuläre septische Komplikationen (z. B. Spondylodiszitis)</li>
                <li>Mykotische Aneurysmen</li>
                <li>Intrakranielle ischämische/hämorrhagische Läsionen</li>
                <li>Konjunktivale Blutungen</li>
                <li>Janeway-Läsionen</li>
              </ul>
            </div>
          </div>
          <span class="pts">Nebenkriterium</span>
        </label>
      </div>

      <div class="item">
        <label>
          <input type="checkbox" id="min_immun">
          <div class="content">
            <div class="title">Immunologische Phänomene</div>
            <div class="explain">
              Beispiele (ESC 2023):
              <ul class="compact">
                <li>Glomerulonephritis</li>
                <li>Osler-Knötchen und Roth-Flecken</li>
                <li>Rheumafaktor</li>
              </ul>
            </div>
          </div>
          <span class="pts">Nebenkriterium</span>
        </label>
      </div>

      <div class="item">
        <label>
          <input type="checkbox" id="min_micro">
          <div class="content">
            <div class="title">Mikrobiologischer Hinweis (ohne Hauptkriterium)</div>
            <div class="explain">
              • Positive Blutkultur, die <b>kein</b> Hauptkriterium erfüllt, <b>oder</b><br>
              • Serologischer Hinweis auf aktive Infektion mit einem für Endokarditis konsistenten Erreger.
            </div>
          </div>
          <span class="pts">Nebenkriterium</span>
        </label>
      </div>

    </div>
  </div>

  <div class="scoreline">
    <div><b>Hauptkriterien:</b> <span class="score" id="maj_count">0</span></div>
    <div><b>Nebenkriterien:</b> <span class="score" id="min_count">0</span></div>
    <span style="flex:1;"></span>
    <button id="copy">Ergebnis kopieren</button>
    <span class="copied" id="copied" style="display:none;">✓ kopiert</span>
  </div>

  <div class="band band-3" id="band">
    <div id="band_def" class="bandbox">
      <strong>DEFINITIV</strong>
      Kriterien erfüllt
    </div>
    <div id="band_pos" class="bandbox">
      <strong>MÖGLICH</strong>
      Kriterien erfüllt
    </div>
    <div id="band_rej" class="bandbox">
      <strong>AUSGESCHLOSSEN</strong>
      Kriterien nicht erfüllt
    </div>
  </div>

  <div class="interpret" id="interpret">
    <strong>Klassifikation:</strong> —
  </div>

  <div class="muted" style="margin-top:10px;">
    Klinische Kriterien (ESC 2023):<br>
    <b>Endokarditis definitiv</b>: 2 Hauptkriterien <i>oder</i> 1 Hauptkriterium + ≥3 Nebenkriterien <i>oder</i> 5 Nebenkriterien (oder pathologisch definitiv).<br>
    <b>Endokarditis möglich</b>: 1 Hauptkriterium + 1–2 Nebenkriterien <i>oder</i> 3–4 Nebenkriterien.<br>
    <b>Endokarditis ausgeschlossen</b>: erfüllt weder „definitiv“ noch „möglich“.
  </div>

</div>

<script>
function clearBand() {
  ["band_def","band_pos","band_rej"].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.classList.remove("band-active");
  });
}
function setBand(id) {
  const el = document.getElementById(id);
  if (el) el.classList.add("band-active");
}

function klassifiziereESC2023(haupt, neben, pathologischDefinitiv) {
  if (pathologischDefinitiv) {
    return {cls: "Endokarditis definitiv", band: "band_def", why: "Pathologische Kriterien erfüllt."};
  }

  if (haupt >= 2) return {cls: "Endokarditis definitiv", band: "band_def", why: "≥2 Hauptkriterien."};
  if (haupt >= 1 && neben >= 3) return {cls: "Endokarditis definitiv", band: "band_def", why: "1 Hauptkriterium + ≥3 Nebenkriterien."};
  if (neben >= 5) return {cls: "Endokarditis definitiv", band: "band_def", why: "≥5 Nebenkriterien."};

  if (haupt >= 1 && (neben === 1 || neben === 2)) return {cls: "Endokarditis möglich", band: "band_pos", why: "1 Hauptkriterium + 1–2 Nebenkriterien."};
  if (neben === 3 || neben === 4) return {cls: "Endokarditis möglich", band: "band_pos", why: "3–4 Nebenkriterien."};

  return {cls: "Endokarditis ausgeschlossen", band: "band_rej", why: "Kriterien für „definitiv“/„möglich“ nicht erfüllt."};
}

function calculate() {
  document.getElementById("copied").style.display = "none";

  const path = document.getElementById("maj_path").checked;

  let haupt = 0;
  if (document.getElementById("maj_bc_typical").checked) haupt += 1;
  if (document.getElementById("maj_bc_cont").checked) haupt += 1;
  if (document.getElementById("maj_cburnetii").checked) haupt += 1;
  if (document.getElementById("maj_imaging").checked) haupt += 1;

  let neben = 0;
  if (document.getElementById("min_pred").checked) neben += 1;
  if (document.getElementById("min_fever").checked) neben += 1;
  if (document.getElementById("min_vascular").checked) neben += 1;
  if (document.getElementById("min_immun").checked) neben += 1;
  if (document.getElementById("min_micro").checked) neben += 1;

  document.getElementById("maj_count").textContent = haupt;
  document.getElementById("min_count").textContent = neben;

  const res = klassifiziereESC2023(haupt, neben, path);

  clearBand();
  setBand(res.band);

  document.getElementById("interpret").innerHTML =
    `<strong>Klassifikation:</strong> ${res.cls} <span class="pill">${res.why}</span>`;

  return {haupt, neben, cls: res.cls};
}

/* Events */
document.querySelectorAll("input[type=checkbox]").forEach(cb => {
  cb.addEventListener("change", calculate);
});

document.getElementById("copy").addEventListener("click", () => {
  const r = calculate();

  const hauptTxt = `${r.haupt} Haupt${(r.haupt === 1) ? "kriterium" : "kriterien"}`;
  const nebenTxt = `${r.neben} Neben${(r.neben === 1) ? "kriterium" : "kriterien"}`;

  const text = `Duke-Kriterien nach ESC 2023: ${r.cls} (${hauptTxt}, ${nebenTxt})`;

  navigator.clipboard.writeText(text).then(() => {
    const msg = document.getElementById("copied");
    msg.style.display = "inline";
    setTimeout(() => msg.style.display = "none", 1500);
  });
});

document.getElementById("reset").addEventListener("click", () => {
  document.querySelectorAll("input[type=checkbox]").forEach(cb => cb.checked = false);
  document.getElementById("copied").style.display = "none";
  calculate();
});

// initial
calculate();
</script>

</body>
</html>
